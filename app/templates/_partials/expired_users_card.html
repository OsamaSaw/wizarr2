{% if expired_users and expired_users|length > 0 %}
  <div id="expired-users-section"
       class="bg-white border border-gray-200 rounded-lg shadow-sm dark:bg-gray-800 dark:border-gray-700 p-6">
    <div class="flex items-center justify-between mb-4">
      <div class="flex items-center">
        <div class="flex-shrink-0">
          <span class="text-2xl">ğŸ—‘ï¸</span>
        </div>
        <div class="ml-3">
          <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Recently Expired Users</h3>
          <p class="text-sm text-gray-600 dark:text-gray-400">Users whose access has expired and been deleted</p>
        </div>
      </div>
      <div class="flex items-center gap-3">
        <button class="text-xs font-medium px-3 py-1.5 rounded-lg border border-gray-300 text-gray-700 hover:bg-gray-100 dark:border-gray-600 dark:text-gray-200 dark:hover:bg-gray-700"
                hx-post="{{ url_for('admin.cleanup_expired_users') }}"
                hx-target="#expired-users-section"
                hx-swap="outerHTML">
          {{ _("Clean duplicates") }}
        </button>
        <div class="text-right">
          <div class="text-2xl font-bold text-gray-900 dark:text-white">{{ expired_users|length }}</div>
          <div class="text-xs text-gray-500 dark:text-gray-400">users</div>
        </div>
      </div>
    </div>
    <div class="space-y-3 max-h-80 overflow-y-auto pr-1">
      {% for user in expired_users %}
        <div class="flex items-center justify-between p-3 bg-gray-50 border border-gray-200 rounded-lg dark:bg-gray-700 dark:border-gray-600">
          <div class="flex items-center space-x-3">
            <div class="flex-shrink-0 w-8 h-8 bg-gray-100 dark:bg-gray-600 rounded-full flex items-center justify-center">
              <span class="text-xs font-medium text-gray-600 dark:text-gray-300">
                {{ user.username[0]|upper if user.username else '?' }}
              </span>
            </div>
            <div>
              <div class="text-sm font-medium text-gray-900 dark:text-white">{{ user.username or 'Unknown' }}</div>
              <div class="text-xs text-gray-500 dark:text-gray-400">
                Expired {{ user.expired_at.strftime("%Y-%m-%d %H:%M") if user.expired_at else 'Unknown' }}
              </div>
            </div>
          </div>
          <div class="flex items-center space-x-2">
            {% if user.server %}
              <span class="hidden sm:inline-flex items-center bg-gray-100 text-gray-800 text-xs px-2 py-1 rounded dark:bg-gray-700 dark:text-gray-300">
                {{ user.server.server_type }}
              </span>
            {% endif %}
            <span class="inline-flex items-center text-xs font-medium px-2.5 py-0.5 rounded bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-300">
              Expired
            </span>
          </div>
        </div>
      {% endfor %}
    </div>
    <div class="mt-3 text-xs text-gray-500 dark:text-gray-400 text-center">
      {{ expired_users|length }} expired user
      {% if expired_users|length != 1 %}s{% endif %}
      {% if expired_users|length > 5 %}- scroll to view all{% endif %}
    </div>
  </div>
{% else %}
  <div id="expired-users-section"
       class="bg-white border border-gray-200 rounded-lg shadow-sm dark:bg-gray-800 dark:border-gray-700 p-6">
    <div class="flex items-center justify-between mb-4">
      <div class="flex items-center">
        <div class="flex-shrink-0">
          <span class="text-2xl">ğŸ—‘ï¸</span>
        </div>
        <div class="ml-3">
          <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Recently Expired Users</h3>
          <p class="text-sm text-gray-600 dark:text-gray-400">Users whose access has expired and been deleted</p>
        </div>
      </div>
      <button class="text-xs font-medium px-3 py-1.5 rounded-lg border border-gray-300 text-gray-700 hover:bg-gray-100 dark:border-gray-600 dark:text-gray-200 dark:hover:bg-gray-700"
              hx-post="{{ url_for('admin.cleanup_expired_users') }}"
              hx-target="#expired-users-section"
              hx-swap="outerHTML">
        {{ _("Clean duplicates") }}
      </button>
    </div>
    <p class="text-gray-500 dark:text-gray-400 text-sm">{{ _("No expired users yet.") }}</p>
  </div>
{% endif %}
